<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dagre 参数变化</title>
    <style>::-webkit-scrollbar{display:none;}html,body{overflow:hidden;margin:0;}</style>
</head>
<style>
    #contextMenu {
      position: absolute;
      list-style: none;
      /* padding: 10px 5px; */
      /* left: -100px; */
      background: #ccc;
      border: 1px solid skyblue;
      border-radius: 5px;
      cursor: pointer;
      padding: 10px 25px;
    }
  
    /* #contextMenu li {
      cursor: pointer;
    } */
</style>
<body>
<div id="mountNode"></div>
<script>/*Fixing iframe window.innerHeight 0 issue in Safari*/document.body.clientHeight;</script>
<script src="https://gw.alipayobjects.com/os/antv/pkg/_antv.g6-3.1.1/build/g6.js"></script>
<script>
  /**
   * 该示例演示 Dagre 布局的参数及其使用，以及如何切换布局参数
   * by 十吾
   */
  var data = {
    "nodes": [{
      "id": "0",
      "label": "000"
    }, {
      "id": "1",
      "label": "001"
    }, {
      "id": "2",
      "label": "002"
    }, {
      "id": "3",
      "label": "003"
    }, {
      "id": "4",
      "label": "4"
    }, {
      "id": "5",
      "label": "5"
    }, {
      "id": "6",
      "label": "6"
    }, {
      "id": "7",
      "label": "7"
    }, {
      "id": "8",
      "label": "8"
    }, {
      "id": "9",
      "label": "9"
    }, {
      "id": "10",
      "label": "10"
    }, {
      "id": "11",
      "label": "11"
    }, {
      "id": "12",
      "label": "12"
    }, {
      "id": "13",
      "label": "13"
    }, {
      "id": "14",
      "label": "14"
    }, {
      "id": "15",
      "label": "15"
    }],
    "edges": [{
      "source": "0",
      "target": "1",
      "label": '0=>1',
    }, {
      "source": "0",
      "target": "2"
    }, {
      "source": "0",
      "target": "3"
    }, {
      "source": "0",
      "target": "4"
    }, {
      "source": "0",
      "target": "5"
    }, {
      "source": "0",
      "target": "7"
    }, {
      "source": "0",
      "target": "8"
    }, {
      "source": "0",
      "target": "9"
    }, {
      "source": "0",
      "target": "10"
    }, {
      "source": "0",
      "target": "11"
    }, {
      "source": "0",
      "target": "13"
    }, {
      "source": "0",
      "target": "14"
    }, {
      "source": "0",
      "target": "15"
    }, {
      "source": "2",
      "target": "3"
    }, {
      "source": "4",
      "target": "5"
    }, {
      "source": "4",
      "target": "6"
    }, {
      "source": "5",
      "target": "6"
    }, {
      "source": "7",
      "target": "13"
    }, {
      "source": "8",
      "target": "14"
    }, {
      "source": "9",
      "target": "10"
    }, {
      "source": "10",
      "target": "14"
    }, {
      "source": "10",
      "target": "12"
    }, {
      "source": "11",
      "target": "14"
    }, {
      "source": "12",
      "target": "13"
    }]
  };
  var graph = new G6.Graph({
    container: 'mountNode',
    width: window.innerWidth,
    height: window.innerHeight,
    modes: {
      default: ['drag-canvas', 'drag-node']
    },
    layout: {
      type: 'dagre',
      rankdir: 'RL',
      nodeSize: [40, 20],
      nodesep: 15,
      ranksep: 30
    },
    animate: true,
    defaultNode: {
      size: [40, 20],
      color: 'steelblue',
      shape: 'rect',
      style: {
        lineWidth: 2,
        fill: '#fff',
        cursor: "pointer"
      },
      on: {
        click: function(item) {
          console.log(item);
        }
      }
    },
    defaultEdge: {
      size: 1,
      color: '#e2e2e2',
      style: {
        endArrow: {
          path: 'M 4,0 L -4,-4 L -4,4 Z',
          d: 4
        }
      }
    }
  });
  graph.data(data);
  graph.render();
    // 在实际开发中，右键菜单内容可以使用JSX或HTML中的模板
  // 创建ul
  var conextMenuContainer = document.createElement('div');
  conextMenuContainer.id = 'contextMenu';
  // conextMenuContainer.addEventListener("click",getDetailInfo(currentItem))
  document.body.appendChild(conextMenuContainer);
  var currentItem;
  var menu = document.getElementById('contextMenu');
  graph.on('node:mouseenter', function(evt) {
    // var target = evt.target;
    // var node = evt.item;
    // var model = node.getModel();
    // model.oriLabel = model.label;
    // graph.setItemState(node, 'hover', true);
    console.log(evt);
    menu.style.display = 'block';
    menu.style.left = evt.x + 'px';
    menu.style.top = evt.y + 'px';
    menu.innerHTML = "详细信息";
    currentItem = evt.item._cfg;
    menu.addEventListener("click",getDetailInfo)
    // graph.updateItem(node, {
    //   label: 'hover 后 ' + model.id,
    //   labelCfg: {
    //     style: {
    //       fill: '#f00'
    //     }
    //   }
    // });
  });
  graph.on('node:mouseleave', function(evt) {
    menu.style.display = 'none';
    // var node = evt.item;
    // var model = node.getModel();
    // graph.setItemState(node, 'hover', false);
    // console.log(node);
    // graph.updateItem(node, {
    //   label: model.oriLabel,
    //   labelCfg: {
    //     style: {
    //       fill: '#555'
    //     }
    //   }
    // });
  });
  graph.on('node:click', function(evt) {
    console.log(evt);
    const nodeObj = {
      "id": "130",
      "label": "130"
    };
    const edgeObj = {
      "source": "13",
      "target": "130",
      "label": '新增的',
    }
    data.nodes.push(nodeObj);
    data.edges.push(edgeObj);
    graph.data(data);
    graph.render();
    // graph.updateData(data);

  });
//   var descriptionDiv = document.createElement("div");
//   descriptionDiv.innerHTML = 'Dagre 布局，层级间距：1，同层节点间距：1，布局方向：Top->Bottom，节点对齐方式：DL';
//   var graphDiv = document.getElementById("mountNode");
//   document.body.insertBefore(descriptionDiv, graphDiv);

//   layoutConfigTranslation();
// document.body.addEventListener("mousemove",function(e) {
//     console.log(e);
// })
  function getDetailInfo() {
    console.log(currentItem);
  }

  function layoutConfigTranslation() {
    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：10，同层节点间距：1，布局方向：Top->Bottom，节点对齐方式：DL';
      graph.updateLayout({
        ranksep: 10
      });
    }, 1000);

    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：10，同层节点间距：5，布局方向：Left->Right，节点对齐方式：DL';
      graph.updateLayout({
        nodesep: 5
      });
    }, 2500);

    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：10，同层节点间距：5，布局方向：Left->Right，节点对齐方式：UL';
      graph.updateLayout({
        align: 'UL'
      });
    }, 4000);

    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：10，同层节点间距：5，布局方向：Left->Right，节点对齐方式：UR';
      graph.updateLayout({
        align: 'UR'
      });
    }, 5500);

    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：10，同层节点间距：5，布局方向：Left->Right，节点对齐方式：Down Right，节点对齐方式：DL';
      graph.updateLayout({
        rankdir: 'LR',
        align: 'DL'
      });
    }, 7000);

    setTimeout(function() {
      descriptionDiv.innerHTML = 'Dagre 布局，层级间距：30，同层节点间距：5，布局方向：Left->Right，节点对齐方式：Down Right，节点对齐方式：DL';
      graph.updateLayout({
        ranksep: 30
      });
    }, 8500);
  }
</script></body>
</html>
